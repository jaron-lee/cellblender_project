% %
% LAYOUT_E.TEX - Short description of REFMAN.CLS
%                                       99-03-20
%
%  Updated for REFMAN.CLS (LaTeX2e)
%
\documentclass[twoside,a4paper]{refart}
\usepackage{makeidx}
\usepackage{float}
\usepackage{ifthen}
\usepackage{graphicx}
% ifthen wird vom Bild von N.Beebe gebraucht!

\def\bs{\char'134 } % backslash in \tt font.
\newcommand{\ie}{i.\,e.,}
\newcommand{\eg}{e.\,g..}
\DeclareRobustCommand\cs[1]{\texttt{\char`\\#1}}

\title{A Guide on Modelling Synapses in CellBlender and MCell}
\author{Jaron Lee}

\date{}
\emergencystretch1em  %

\makeindex 

\setcounter{tocdepth}{2}

\begin{document}

\maketitle

\begin{abstract}
    This guide aims to improve on the work by Czech et. al., by updating the guide for the MCell - CellBlender software.
\end{abstract}

%\marginlabel{Start Blender}
\newpage


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Pre- and Postsynaptic Genomtry with Blender}
This section follows the paper written by Czech et. al. closely. It is expected that users will have familiarised themselves with Blender, and have read the MCell - CellBlender guide online.

\subsection{Creating a Spine Head}

\begin{enumerate}

\item   Open Blender. In the '3D View' pane, delete the default object (shortcut: x)
    
\item   Create a sphere. Select the 'UV Sphere' option from the sidebar. Below a pane called 'Add Circle' appears; set 'Segments' and 'Rings' to 16, 'Radius to '0.25'. 
        \begin{figure}[H]
        \includegraphics[scale=0.5]{spinehead1.png}
        \end{figure}

\item   Rename the sphere. Double-click the entry box below to change the default name to 'SpineHead'.
        \begin{figure}[H]
        \includegraphics[scale=0.5]{spinehead2.png}
        \end{figure}

\item   Change view to see the sphere from the 'Front' view. (shortcut: 1 on numpad)

\item   Deselect the sphere (shortcut: a) and make it transparent (shortcut: z)

\item   Select the vertices to be removed. First, switch from 'Object Mode' to 'Edit Mode'. Ensure that 'Edge select' is enabled. Then use box select (shortcut: b) to capture only the faces that make up the top half of the sphere. Delete these faces (shortcut: x) and select the 'Faces' option in the delete menu.
        \begin{figure}[H]
        \includegraphics[scale=0.5]{spinehead3.png}
        \end{figure}

\item   Close the opening. Select the topmost vertices (remaining in 'Edge select' mode) using box select (shortcut: b). Then, extrude (shortcut: e) and click 'Edges Only' under 'Extrude' in 'Mesh Tools'.        
        \begin{figure}[H]
        \includegraphics[scale=0.5]{spinehead4.png}
        \end{figure}
        Set the extrude distance by pressing 0 and Enter to confirm. Scale the extrusion by pressing s, 0 and Enter to confirm. Select 'Remove Doubles' under 'Mesh Tools' to remove the duplicated vertices and reconnect the triangles. Blender should note that you remove 15 vertices as a result.
        \begin{figure}[H]
        \includegraphics[scale=0.5]{spinehead5.png}
        \end{figure}
        The object should now be closed by a flat top.

\item   Subdivide triangles at the top. Unfortunately the 'Multicut tool' has been deprecated. To create set of concentric rings, first select the topmost vertices (shortcut: b). Then enter 'Knife' mode (shortcut: k), and hold down \textit{control}. This locks the knife cut to the midpoint. Click around to make a circle cut, and then press \textit{Enter} to complete the cut. Continue these cuts until the picture looks as below:
        \begin{figure}[H]
        \includegraphics[scale=0.5]{spinehead6.png}
        \end{figure}
         
\end{enumerate}

\subsection{Creating a presynaptic bouton}

\begin{enumerate}
    \item   Duplicate the \textit{spine.blend} file as \textit{bouton.blend}. in \textit{bouton.blend} deselect all (shortcut: a).
    
\item   Duplicate the spine head and rotate. First, switch to 'Front' view (shortcut: 1 on numpad). Duplicate (shortcut: Shift-d, Enter) and rotate 180 degrees (shortcut: r, 180, Enter). To separate the selection of the spine heads, press p and click 'Selection'.

\item   Rename the item. Switch to 'Object Mode' (shortcut: Tab) and edit the name field to 'PresynapticBouton'.
        \begin{figure}[H]
        \includegraphics[scale=0.5]{bouton1.png}
        \end{figure}

\item   Shift and scale the bouton. Grab the object (shortcut: g), constrain movement to the z-axis (shortcut: z) and type 0.15, \textit{Enter} to move the object. Scale the object to be 20\% larger by typing s, 1.2, \textit{Enter}.

\item   Creating the invagination. Switch to 'Edit Mode' (shortcut: Tab) and deselect everything (shortcut: a). Select the lowermost vertices (see below) and perform the 'Select Less' operation (shortcut: Control-Minus on numpad). Click the 'Extrude Region' button under 'Add' in 'Tools', press z to constrain, and type -0.075 to extrude it upwards.
        \begin{figure}[H]
        \includegraphics[scale=0.5]{bouton2.png}
        \end{figure}

\end{enumerate}

\subsection{Adding Axonal and Dendritic Extensions}

\begin{enumerate}

\item   Enter 'Edit Mode' (shortcut: Tab), and switch view to front (shortcut: 1 on numpad)

\item   Zoom in on the top of the vertex. Select the vertex by right-clicking on it, ensuring that 'Vertex mode' selection is enabled. Perform two 'Select More' operations (shortcut: Control-Plus on numpad) until two rings are highlighted. Press x, select 'Faces' on the menu, \textit{Enter} to confirm. Press b and select the vertices on the top edge using 'Box select'. Press e, click on 'Edges Only' in 'Tools' (left pane), then type z, 3.0, \textit{Enter}. This should produce an axon on the presynaptic bouton.

\item   Select the spine head. Hit \textit{Tab} to enter 'Object Mode' and right click the spine head (the bottom half-sphere) to select it. \textit{Tab} back into 'Edit Mode'

\item   Create a cylindrical spine on the spine head. As in the earlier step, select the bottom vertex, perform two 'Select More' operations, press x and select 'Faces' on the 'Erase' menu. Hit b and select the vertices that line the hole in the bottom. Press e, select 'Edges Only' in 'Tools', press z, type -2.0, \textit{Enter}. 

\end{enumerate}

\subsection{Add Synaptic Vesicles with Regions for Calcium Binding}

\begin{enumerate}
\item   Create the first vesicle. First, ensure that the object is at the origin by moving it if necessary (shortcut: g). Move the cursor to the origin (shortcut: \textit{Shift}-c). Ensure that 'Object Mode' is enabled. Under the 'Create' tab at left, select Ico-Sphere. A pane appears at lower left - change the default settings to 1 subdivision a size of 0.02. A small sphere should appear at the origin.

\item   It is necessary to rotate the vesicle. With the sphere selected, press r, x, 90, \textit{Enter} to align the sphere with the x-axis. Enter the 'Object' tab at right, and edit the name of the sphere to 'Vesicle'.

\item   Define the calcium binding region. With the vesicle still selected, change to 'Edit Mode' (shortcut: \textit{Tab}) and triangulate the faces (shortcut: \textit{Control-t}). First, select the 'Define Surface Region' tab which is under the 'Object' tab. Add a new region and name it 'vesicle1'. With the vesicle selected, click 'Assign'. We must now add the vesicle to the list of mesh objects to be included in the simulation. Under the 'Scene' tab, select 'Model Objects' and add the vesicle to this list. A green tick should appear.
        \begin{figure}[H]
        \includegraphics[scale=0.5]{vesicle1.png}
        \end{figure}

        \begin{figure}[H]
        \includegraphics[scale=0.5]{vesicle2.png}
        \end{figure}

\item   Move the vesicle. Tab into 'Object Mode', press g to grab the vesicle, type x, -0.108 \textit{Enter} to move the vesicle along the x-axis. Hit g, 0.105, \textit{Enter} to move it 0.105 units along the z-axis.

\item   Duplicate the vesicle. Hit \textit{Shift}-d, g, 0.216, \textit{Enter} to move the vesicle the appropriate distance. Then, restrict visibility of the Presynaptic Bouton, select both vesicles, and under 'Define Surface Region' hit the assign button again.

        \begin{figure}[H]
        \includegraphics[scale=0.5]{vesicle3.png}
        \end{figure}


\end{enumerate}
\end{document}
